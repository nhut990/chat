<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Web Test Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f0f4f8;
      margin: 0;
      padding: 20px;
      font-size: 18px;
    }
    h1 {
      text-align: center;
      color: #0078D4;
      margin-bottom: 10px;
    }
    h2 {
      color: #333;
      margin-top: 20px;
      font-size: 22px;
      font-weight: 700;
    }
    h3 {
      color: #222;
      margin-top: 26px;
      font-size: 26px;
      font-weight: bold;
    }
    textarea {
      width: 100%;
      font-size: 16px;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ccc;
      margin-bottom: 10px;
      box-sizing: border-box;
      resize: vertical;
    }
    #passwordInput {
      width: 100%;
      font-size: 16px;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ccc;
      box-sizing: border-box;
      margin-bottom: 10px;
    }
    button {
      font-size: 16px;
      padding: 10px 20px;
      background-color: #0078D4;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 10px;
      margin-right: 10px;
    }
    button:hover {
      background-color: #005fa3;
    }
    .note-card {
      background-color: #ffffff;
      border: 1px solid #ddd;
      border-radius: 16px;
      padding: 15px 15px 44px 15px;
      margin-top: 18px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.06);
      position: relative;
      min-height: 62px;
    }
    .timestamp {
      font-size: 16px;
      color: #222;
      margin-top: 7px;
      font-style: italic;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .note-content {
      font-size: 16px;
      word-break: break-word;
      margin-bottom: 2px;
    }
    .note-index {
      position: absolute;
      bottom: 10px;
      left: 10px;
      background-color: #0078D4;
      color: #fff;
      min-width: 32px;
      border-radius: 16px;
      font-weight: bold;
      font-size: 16px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.10);
      user-select: none;
      height: 28px;
      line-height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2;
      padding: 0 8px;
    }
    .delete-btn {
      position: absolute;
      bottom: 10px;
      right: 10px;
      background-color: #e74c3c;
      color: white;
      border: none;
      border-radius: 7px;
      padding: 0 12px;
      font-size: 16px;
      cursor: pointer;
      height: 28px;
      line-height: 28px;
      min-width: unset;
      width: auto;
      box-sizing: border-box;
      transition: background 0.22s;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .delete-btn:hover {
      background-color: #c0392b;
    }
    .deleted-label {
      position: absolute;
      bottom: 10px;
      right: 10px;
      color: green;
      font-weight: bold;
      font-size: 15px;
    }
    .action-buttons {
      display: flex;
      gap: 10px;
      margin-top: 30px;
    }
    .action-buttons button {
      flex: 1;
      margin: 0;
      padding: 16px;
      font-size: 18px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: bold;
      box-shadow: 0 2px 4px rgba(0,0,0,0.08);
    }
    #deleteAllBtn {
      background-color: #e74c3c;
      color: white;
      border: none;
    }
    #deleteAllBtn:hover {
      background-color: #c0392b;
    }
    #downloadBtn {
      background-color: #28a745;
      color: white;
      border: none;
    }
    #downloadBtn:hover {
      background-color: #218838;
    }
    #footer {
      margin-top: 30px;
      font-size: 18px;
      color: #555;
      text-align: center;
    }
    #message {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background-color: white;
      padding: 15px 30px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      font-weight: bold;
      text-align: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease-out, visibility 0.3s ease-out;
    }
    #message.show {
      opacity: 1;
      visibility: visible;
    }
    .warning {
      color: #e74c3c !important;
    }
    @media(max-width: 600px) {
      .note-card { font-size: 16px; padding: 10px 10px 38px 10px;}
      .note-content,.timestamp { font-size: 15px; }
      .note-index { font-size: 14px; min-width:22px; height:22px; line-height:22px; border-radius:11px; padding:0 7px;}
      .delete-btn, .deleted-label { font-size: 14px; height:22px; border-radius:5px; }
      .action-buttons button {font-size:16px;padding:10px;border-radius:8px;}
    }
  </style>
</head>
<body>
  <h1>Web Test Demo</h1>
  <h2>üìù Ghi ch√∫ tr·ª±c tuy·∫øn</h2>
  <textarea id="noteInput" rows="5" placeholder="Nh·∫≠p ghi ch√∫ t·∫°i ƒë√¢y..."></textarea>
  <input type="password" id="passwordInput" placeholder="Nh·∫≠p m·∫≠t kh·∫©u ƒë·ªÉ t·∫°o ghi ch√∫ (b·∫Øt bu·ªôc)">
  <button onclick="saveNote()">L∆∞u ghi ch√∫</button>

  <h3>üìå Ghi ch√∫ ƒë√£ l∆∞u:</h3>
  <div id="noteList"></div>

  <div id="message"></div>

  <div class="action-buttons">
    <button id="deleteAllBtn" onclick="deleteAllNotes()">üóëÔ∏è X√≥a t·∫•t c·∫£ ghi ch√∫</button>
    <button id="downloadBtn" onclick="downloadNotes()">üì• T·∫£i to√†n b·ªô ghi ch√∫</button>
  </div>

  <div id="footer">
    üåê ƒê√¢y l√† phi√™n b·∫£n th·ª≠ nghi·ªám c·ªßa h·ªá th·ªëng ghi ch√∫ tr·ª±c tuy·∫øn, ƒë∆∞·ª£c thi·∫øt k·∫ø nh·∫±m h·ªó tr·ª£ ƒë·ªìng b·ªô h√≥a n·ªôi dung gi·ªØa c√°c th√†nh vi√™n trong nh√≥m ‚Äî gi√∫p l√†m vi·ªác nh√≥m hi·ªáu qu·∫£ h∆°n, m·ªçi ng∆∞·ªùi c√πng nh√¨n th·∫•y v√† c·∫≠p nh·∫≠t ghi ch√∫ theo th·ªùi gian th·ª±c.
  </div>

  <script>
    var firebaseConfig = {
      databaseURL: "https://test-nhut117117-default-rtdb.asia-southeast1.firebasedatabase.app/"
    };
    firebase.initializeApp(firebaseConfig);
    var database = firebase.database();
    let noteCount = 0;

    function saveNote() {
      var note = document.getElementById("noteInput").value;
      var password = document.getElementById("passwordInput").value;
      if (note.trim() === "") {
        showMessage("‚ö†Ô∏è Vui l√≤ng nh·∫≠p n·ªôi dung ghi ch√∫!", "orange");
        return;
      }
      if (password.trim() === "") {
        showMessage("‚ö†Ô∏è B·∫°n ph·∫£i nh·∫≠p m·∫≠t kh·∫©u ƒë·ªÉ t·∫°o ghi ch√∫!", "orange");
        return;
      }
      var newNoteRef = database.ref("notes").push();
      newNoteRef.set({
        content: note,
        timestamp: new Date().toISOString(),
        password: password
      });
      document.getElementById("noteInput").value = "";
      document.getElementById("passwordInput").value = "";
      showMessage("‚úÖ ƒê√£ l∆∞u ghi ch√∫ th√†nh c√¥ng!", "green");
    }

    function formatDate(isoString) {
      const date = new Date(isoString);
      return date.toLocaleString('vi-VN', {
        hour: '2-digit', minute: '2-digit',
        day: '2-digit', month: '2-digit', year: 'numeric'
      });
    }

    function deleteNote(noteId, cardElement, creatorPassword) {
      const password = prompt("Nh·∫≠p m·∫≠t kh·∫©u (c·ªßa ng∆∞·ªùi t·∫°o ho·∫∑c admin) ƒë·ªÉ x√≥a ghi ch√∫:");
      if (password === creatorPassword || password === "898989") {
        database.ref("notes/" + noteId).remove()
          .then(() => {
            const label = document.createElement("div");
            label.className = "deleted-label";
            label.textContent = "‚úÖ ƒê√£ xo√°";
            cardElement.innerHTML = "";
            cardElement.appendChild(label);
            showMessage("‚úÖ ƒê√£ x√≥a ghi ch√∫ th√†nh c√¥ng!", "green");
            setTimeout(() => {
              cardElement.style.display = "none";
            }, 2800);
          })
          .catch((error) => {
            showMessage("‚ùå L·ªói khi x√≥a: " + error.message, "red");
          });
      } else if (password !== null) {
        showMessage("‚ùå Sai m·∫≠t kh·∫©u. Kh√¥ng th·ªÉ x√≥a ghi ch√∫.", "red");
      }
    }

    function deleteAllNotes() {
      if (noteCount === 0) {
        showMessage("‚ö†Ô∏è Ch∆∞a c√≥ ghi ch√∫ ƒë·ªÉ x√≥a.", "orange");
        return;
      }
      const confirmDelete = confirm(`‚ö†Ô∏è B·∫†N CH·∫ÆC CH·∫ÆN MU·ªêN X√ìA T·∫§T C·∫¢ ${noteCount} GHI CH√ö?\n\nH√†nh ƒë·ªông n√†y KH√îNG TH·ªÇ ho√†n t√°c!`);
      if (confirmDelete) {
        const password = prompt("Nh·∫≠p m·∫≠t kh·∫©u admin ƒë·ªÉ x√°c nh·∫≠n x√≥a t·∫•t c·∫£ ghi ch√∫:");
        if (password === "898989") {
          database.ref("notes").remove()
            .then(() => {
              showMessage("‚úÖ ƒê√£ x√≥a t·∫•t c·∫£ ghi ch√∫ th√†nh c√¥ng!", "green");
            })
            .catch((error) => {
              showMessage("‚ùå L·ªói khi x√≥a: " + error.message, "red");
            });
        } else if (password !== null) {
          alert("‚ùå Ch·ªâ admin m·ªõi c√≥ quy·ªÅn x√≥a t·∫•t c·∫£ ghi ch√∫.");
        }
      }
    }

    function downloadNotes() {
      if (noteCount === 0) {
        showMessage("‚ö†Ô∏è Ch∆∞a c√≥ ghi ch√∫ ƒë·ªÉ t·∫£i.", "orange");
        return;
      }
      database.ref("notes").once("value", function(snapshot) {
        let content = "";
        const notesArray = [];
        snapshot.forEach(function(childSnapshot) {
          notesArray.push(childSnapshot.val());
        });
        notesArray.reverse();
        let totalNotes = notesArray.length;
        notesArray.forEach(function(data, i) {
          const time = formatDate(data.timestamp);
          content += `${totalNotes - i} - üìù ${data.content}\nüïí ${time}\n\n`;
        });

        const blob = new Blob(["\uFEFF" + content], { type: "text/plain;charset=utf-8" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        const dateStr = new Date().toLocaleDateString('vi-VN').replace(/\//g, '-');
        link.download = `ghi_chu_${dateStr}.txt`;
        link.click();
        showMessage("‚úÖ ƒê√£ t·∫£i xu·ªëng ghi ch√∫ th√†nh c√¥ng!", "green");
      });
    }

    function showMessage(text, color) {
      const msgElement = document.getElementById("message");
      msgElement.textContent = text;
      msgElement.style.color = color;
      msgElement.classList.add("show");
      setTimeout(() => {
        msgElement.classList.remove("show");
      }, 5000);
    }

    database.ref("notes").on("value", function(snapshot) {
      var noteList = document.getElementById("noteList");
      noteList.innerHTML = "";
      noteCount = 0;
      const notesArray = [];
      snapshot.forEach(function(childSnapshot) {
        notesArray.push({
          id: childSnapshot.key,
          data: childSnapshot.val()
        });
      });

      notesArray.reverse();
      noteCount = notesArray.length;

      if (noteCount === 0) {
        noteList.innerHTML = '<div style="text-align: center; color: #888; padding: 20px;">Ch∆∞a c√≥ ghi ch√∫ n√†o. H√£y th√™m ghi ch√∫ ƒë·∫ßu ti√™n!</div>';
      }

      for (let i = 0; i < notesArray.length; i++) {
        const noteItem = notesArray[i];
        const data = noteItem.data;
        const noteId = noteItem.id;
        const note = data.content;
        const time = formatDate(data.timestamp);
        const password = data.password || "";

        const card = document.createElement("div");
        card.className = "note-card";

        const content = document.createElement("div");
        content.className = "note-content";
        content.textContent = note;

        const timestamp = document.createElement("div");
        timestamp.className = "timestamp";
        timestamp.innerHTML = `<span style="font-size:18px;vertical-align:middle">üïì</span> <span style="margin-left:4px;font-style:italic;">${time}</span>`;

        const indexBadge = document.createElement("div");
        indexBadge.className = "note-index";
        indexBadge.textContent = (noteCount - i);

        const deleteBtn = document.createElement("button");
        deleteBtn.className = "delete-btn";
        deleteBtn.textContent = "X√≥a";
        deleteBtn.onclick = ((nid, cardEl, pw) => {
          return function() {
            deleteNote(nid, cardEl, pw);
          };
        })(noteId, card, password);

        card.appendChild(content);
        card.appendChild(timestamp);
        card.appendChild(indexBadge);
        card.appendChild(deleteBtn);
        noteList.appendChild(card);
      }
    });
  </script>
</body>
</html>