<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Web Test Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f0f4f8;
      margin: 0;
      padding: 20px;
      font-size: 18px;
    }
    h1 {
      text-align: center;
      color: #0078D4;
      margin-bottom: 10px;
    }
    h2, h3 {
      color: #333;
      margin-top: 20px;
    }
    textarea {
      width: 100%;
      font-size: 16px;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ccc;
      margin-bottom: 10px;
      box-sizing: border-box;
      resize: vertical;
    }
    button {
      font-size: 16px;
      padding: 10px 20px;
      background-color: #0078D4;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 10px;
      margin-right: 10px;
    }
    button:hover {
      background-color: #005fa3;
    }
    .note-card {
      background-color: #ffffff;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      padding-bottom: 50px;
      margin-top: 15px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      position: relative;
    }
    .timestamp {
      font-size: 14px;
      color: #888;
      margin-top: 8px;
    }
    .note-index {
      position: absolute;
      bottom: 10px;
      left: 16px;
      background-color: #0078D4;
      color: #fff;
      padding: 4px 12px;
      border-radius: 14px;
      font-weight: bold;
      font-size: 17px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08);
      user-select: none;
    }
    .delete-btn {
      position: absolute;
      bottom: 10px;
      right: 10px;
      background-color: #e74c3c;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 5px 10px;
      font-size: 14px;
      cursor: pointer;
    }
    .delete-btn:hover {
      background-color: #c0392b;
    }
    .deleted-label {
      position: absolute;
      bottom: 10px;
      right: 10px;
      color: green;
      font-weight: bold;
      font-size: 14px;
    }
    .action-buttons {
      display: flex;
      gap: 10px;
      margin-top: 30px;
    }
    .action-buttons button {
      flex: 1;
      margin: 0;
      padding: 12px;
      font-size: 16px;
      border-radius: 6px;
      cursor: pointer;
    }
    #deleteAllBtn {
      background-color: #e74c3c;
      color: white;
      border: none;
    }
    #deleteAllBtn:hover {
      background-color: #c0392b;
    }
    #downloadBtn {
      background-color: #28a745;
      color: white;
      border: none;
    }
    #downloadBtn:hover {
      background-color: #218838;
    }
    #footer {
      margin-top: 30px;
      font-size: 16px;
      color: #555;
      text-align: center;
    }
    #message {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background-color: white;
      padding: 15px 30px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      font-weight: bold;
      text-align: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease-out, visibility 0.3s ease-out;
    }
    #message.show {
      opacity: 1;
      visibility: visible;
    }
    .warning {
      color: #e74c3c !important;
    }
  </style>
</head>
<body>
  <h1>Web Test Demo</h1>
  <h2>üìù Ghi ch√∫ tr·ª±c tuy·∫øn</h2>
  <textarea id="noteInput" rows="5" placeholder="Nh·∫≠p ghi ch√∫ t·∫°i ƒë√¢y..."></textarea>
  <button onclick="saveNote()">L∆∞u ghi ch√∫</button>

  <h3>üìå Ghi ch√∫ ƒë√£ l∆∞u:</h3>
  <div id="noteList"></div>

  <div id="message"></div>

  <div class="action-buttons">
    <button id="deleteAllBtn" onclick="deleteAllNotes()">üóëÔ∏è X√≥a t·∫•t c·∫£ ghi ch√∫</button>
    <button id="downloadBtn" onclick="downloadNotes()">üì• T·∫£i to√†n b·ªô ghi ch√∫</button>
  </div>

  <div id="footer">
    üåê ƒê√¢y l√† phi√™n b·∫£n th·ª≠ nghi·ªám c·ªßa h·ªá th·ªëng ghi ch√∫ tr·ª±c tuy·∫øn, ƒë∆∞·ª£c thi·∫øt k·∫ø nh·∫±m h·ªó tr·ª£ ƒë·ªìng b·ªô h√≥a n·ªôi dung gi·ªØa c√°c th√†nh vi√™n trong nh√≥m ‚Äî gi√∫p l√†m vi·ªác nh√≥m hi·ªáu qu·∫£ h∆°n, m·ªçi ng∆∞·ªùi c√πng nh√¨n th·∫•y v√† c·∫≠p nh·∫≠t ghi ch√∫ theo th·ªùi gian th·ª±c.
  </div>

  <script>
    var firebaseConfig = {
      databaseURL: "https://test-nhut117117-default-rtdb.asia-southeast1.firebasedatabase.app/"
    };
    firebase.initializeApp(firebaseConfig);
    var database = firebase.database();
    let noteCount = 0;

    function saveNote() {
      var note = document.getElementById("noteInput").value;
      if (note.trim() !== "") {
        var newNoteRef = database.ref("notes").push();
        newNoteRef.set({
          content: note,
          timestamp: new Date().toISOString()
        });
        document.getElementById("noteInput").value = "";
        showMessage("‚úÖ ƒê√£ l∆∞u ghi ch√∫ th√†nh c√¥ng!", "green");
      } else {
        showMessage("‚ö†Ô∏è Vui l√≤ng nh·∫≠p n·ªôi dung ghi ch√∫!", "orange");
      }
    }

    function formatDate(isoString) {
      const date = new Date(isoString);
      return date.toLocaleString('vi-VN', {
        hour: '2-digit', minute: '2-digit',
        day: '2-digit', month: '2-digit', year: 'numeric'
      });
    }

    function deleteNote(noteId, cardElement) {
      const password = prompt("Nh·∫≠p m·∫≠t kh·∫©u ƒë·ªÉ x√≥a ghi ch√∫:");
      if (password === "898989") {
        database.ref("notes/" + noteId).remove()
          .then(() => {
            const label = document.createElement("div");
            label.className = "deleted-label";
            label.textContent = "‚úÖ ƒê√£ xo√°";
            cardElement.innerHTML = "";
            cardElement.appendChild(label);
            showMessage("‚úÖ ƒê√£ x√≥a ghi ch√∫ th√†nh c√¥ng!", "green");
            setTimeout(() => {
              cardElement.style.display = "none";
            }, 3000);
          })
          .catch((error) => {
            showMessage("‚ùå L·ªói khi x√≥a: " + error.message, "red");
          });
      } else if (password !== null) {
        showMessage("‚ùå Sai m·∫≠t kh·∫©u. Kh√¥ng th·ªÉ x√≥a ghi ch√∫.", "red");
      }
    }

    function deleteAllNotes() {
      if (noteCount === 0) {
        showMessage("‚ö†Ô∏è Ch∆∞a c√≥ ghi ch√∫ ƒë·ªÉ x√≥a.", "orange");
        return;
      }

      const confirmDelete = confirm(`‚ö†Ô∏è B·∫†N CH·∫ÆC CH·∫ÆN MU·ªêN X√ìA T·∫§T C·∫¢ ${noteCount} GHI CH√ö?\n\nH√†nh ƒë·ªông n√†y KH√îNG TH·ªÇ ho√†n t√°c!`);
      
      if (confirmDelete) {
        const password = prompt("Nh·∫≠p m·∫≠t kh·∫©u ƒë·ªÉ x√°c nh·∫≠n x√≥a t·∫•t c·∫£ ghi ch√∫:");
        if (password === "898989") {
          database.ref("notes").remove()
            .then(() => {
              showMessage("‚úÖ ƒê√£ x√≥a t·∫•t c·∫£ ghi ch√∫ th√†nh c√¥ng!", "green");
            })
            .catch((error) => {
              showMessage("‚ùå L·ªói khi x√≥a: " + error.message, "red");
            });
        } else if (password !== null) {
          alert("‚ùå Sai m·∫≠t kh·∫©u. Kh√¥ng th·ªÉ x√≥a ghi ch√∫.");
        }
      }
    }

    function downloadNotes() {
      if (noteCount === 0) {
        showMessage("‚ö†Ô∏è Ch∆∞a c√≥ ghi ch√∫ ƒë·ªÉ t·∫£i.", "orange");
        return;
      }

      database.ref("notes").once("value", function(snapshot) {
        let content = "";
        const notesArray = [];
        snapshot.forEach(function(childSnapshot) {
          notesArray.push(childSnapshot.val());
        });
        notesArray.reverse();

        let totalNotes = notesArray.length;
        notesArray.forEach(function(data, i) {
          const time = formatDate(data.timestamp);
          // Ch·ªâ ghi s·ªë, kh√¥ng c√≥ k√Ω t·ª± #, ghi s·ªë th·ª© t·ª± ng∆∞·ª£c (1 l√† m·ªõi nh·∫•t)
          content += `${totalNotes - i} - üìù ${data.content}\nüïí ${time}\n\n`;
        });

        const blob = new Blob(["\uFEFF" + content], { type: "text/plain;charset=utf-8" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        const dateStr = new Date().toLocaleDateString('vi-VN').replace(/\//g, '-');
        link.download = `ghi_chu_${dateStr}.txt`;
        link.click();
        showMessage("‚úÖ ƒê√£ t·∫£i xu·ªëng ghi ch√∫ th√†nh c√¥ng!", "green");
      });
    }

    function showMessage(text, color) {
      const msgElement = document.getElementById("message");
      msgElement.textContent = text;
      msgElement.style.color = color;
      msgElement.classList.add("show");
      setTimeout(() => {
        msgElement.classList.remove("show");
      }, 5000);
    }

    database.ref("notes").on("value", function(snapshot) {
      var noteList = document.getElementById("noteList");
      noteList.innerHTML = "";
      noteCount = 0;

      const notesArray = [];
      snapshot.forEach(function(childSnapshot) {
        notesArray.push({
          id: childSnapshot.key,
          data: childSnapshot.val()
        });
      });

      notesArray.reverse();
      noteCount = notesArray.length;

      if (noteCount === 0) {
        noteList.innerHTML = '<div style="text-align: center; color: #888; padding: 20px;">Ch∆∞a c√≥ ghi ch√∫ n√†o. H√£y th√™m ghi ch√∫ ƒë·∫ßu ti√™n!</div>';
      }

      // Th√™m s·ªë th·ª© t·ª± ng∆∞·ª£c t·ª´ d∆∞·ªõi l√™n (s·ªë th√¥i, kh√¥ng c√≥ "#", n·∫±m d∆∞·ªõi g√≥c tr√°i)
      for (let i = 0; i < notesArray.length; i++) {
        var noteItem = notesArray[i];
        var data = noteItem.data;
        var noteId = noteItem.id;
        var note = data.content;
        var time = formatDate(data.timestamp);

        var card = document.createElement("div");
        card.className = "note-card";

        var content = document.createElement("div");
        content.textContent = note;

        var timestamp = document.createElement("div");
        timestamp.className = "timestamp";
        timestamp.textContent = "üïí " + time;

        var indexBadge = document.createElement("div");
        indexBadge.className = "note-index";
        indexBadge.textContent = (noteCount - i); // Ch·ªâ ghi s·ªë

        var deleteBtn = document.createElement("button");
        deleteBtn.className = "delete-btn";
        deleteBtn.textContent = "X√≥a";
        deleteBtn.onclick = function() {
          deleteNote(noteId, card);
        };

        card.appendChild(content);
        card.appendChild(timestamp);
        card.appendChild(indexBadge); // Badge n·∫±m cu·ªëi
        card.appendChild(deleteBtn);
        noteList.appendChild(card);
      }
    });
  </script>

</body>
</html>